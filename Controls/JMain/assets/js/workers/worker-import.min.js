self.requestFileSystemSync=self.webkitRequestFileSystemSync||self.requestFileSystemSync,self.Promise||self.importScripts("https://www.promisejs.org/polyfills/promise-6.1.0.js"),self.Request||self.importScripts("../polyfills/fetch.js"),self.tools||self.importScripts("worker-tools.js");var ajax={},constFs={SIZEFILES:10485760,READ:{create:0},WRITE:{create:1}};(function(){function e(e){try{if(!e.cache||!r)return self.tools.ajax.send(e);e.update=!0;var t=r.root.getFile(e.name,constFs.READ);return e.blob=t.file(),e.file&&e.file.jdate>Date.parse(e.blob.lastModifiedDate)?self.tools.ajax.send(e):(e.update=!1,new Promise(function(t,s){try{t(self.tools.ajax.getObject(e))}catch(e){s(e)}}))}catch(t){if(t.toString().indexOf("NotFoundError")>-1)return self.tools.ajax.send(e);self.tools.ajax.error(t,e.name)}}function t(e,t){var s=t.clone();return s.blob().then(function(t){var s=r.root.getFile(e.name,constFs.WRITE);s.remove(),s=r.root.getFile(e.name,constFs.WRITE);var o=s.createWriter();return o.write(t),t}).catch(function(e){self.tools.ajax.error(new Error(e).stack)})}function s(){var e=r.root.createReader(),t=e.readEntries();for(var s in t)t[s].remove()}var r=null;self.requestFileSystemSync&&(r=r||self.requestFileSystemSync(TEMPORARY,constFs.SIZEFILES)),this.getFile=e,this.save=t,this.removeAll=s}).apply(ajax),self.addEventListener("message",function(e){var t=e.data;t.getFile=ajax.getFile,t.save=ajax.save;try{self.tools.ajax.get(e.data).then(self.postMessage).catch(self.tools.ajax.error)}catch(e){throw console.log(t),new Error(e)}});