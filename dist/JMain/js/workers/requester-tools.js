self.tools={},function(){function x(){return l?Promise.resolve():caches.open(r).then((b)=>l=b)}function y(d){if(t==d.src&&m)return g(d,new Request(d.srcToRequest,{method:'POST',body:'[]'}));let a=new Request(d.srcToRequest,{method:d.method,cache:'no-cache',headers:new Headers({"Content-Type":d.mime,HEADER_JR:s}),body:JSON.stringify(d.value)});return fetch(a).then(function(a){if(!a.ok)throw`${a.status} ${a.statusText}`;let b;return b=d.cache?d.saveFile(d,a).then(f):g(d,a),b},(b)=>{throw b.message})}function b(b){return b.response instanceof Response?b.response:{result:b.result,path:b.src,observedId:b.observedId,ext:b.ext}}function a(f){var a,b,c=f.name.indexOf('?'),g=f.name;switch(-1<c&&(g=g.substring(0,c)),b=g.split('.'),b=b[b.length-1].toLowerCase(),b){case'jpg':case'png':a=p.BLOB,b='blob';break;case'css':a=p.CSS;break;case'js':a=p.JS;break;case'json':a=p.JSON,f.isText=!0,f.methodBody='json';break;case'txt':case'html':a=p.TEXT,f.methodBody='text',f.isText=!0;break;default:a=p.JS,b='js';}f.ext=b,f.mime=f.mime||a}function c(c){var a='Error: ';return a+=c,a+=', ',j?j(c.toString()):void 0,c}function z(d){return new Promise((a,e)=>{null===d.onerror&&(d.onerror=(a)=>e(a,d)),null===d.onsuccess?d.onsuccess=(b)=>a(b,d):a(d)})}function d(){let d,e;return new Promise(async(b)=>n?b(n):void(m=!1,o=navigator.onLine?await fetch(new Request(t,{cache:'no-cache'})).then((b)=>b.json()):{},d=indexedDB.open(q.NAME,q.VERSION),d.onupgradeneeded=async(c)=>{m=!0,n=c.target.result,e=n.createObjectStore(q.TABLE,{keyPath:q.KEYPATH}),e.createIndex(q.TABLE,q.KEYPATH),e.transaction.oncomplete=()=>b(n)},z(d).then((c)=>b(n=c.target.result))))}function e(f){async function a(a){let e=k[a.name],c=e&&!isNaN(a.date)?e.valueOf()>=a.date:!0;return!c&&(await l.match(f.src))&&(c=!0),c}return new Promise((b)=>k?b(a(f)):void d().then((c)=>{if(t==f.src&&m)return b(!1);let d=c.transaction(q.TABLE,'readonly').objectStore(q.TABLE).getAll();return z(d).then(()=>{k={},d.result.forEach((b)=>k[b[q.KEYPATH]]=b.date),b(a(f))})}))}function f(e){return d().then((a)=>{let b=a.transaction(q.TABLE,'readwrite').objectStore(q.TABLE).put({name:e.name,date:e.date});return z(b).then(()=>(k[e[q.KEYPATH]]=e.date,e))})}function g(c,a){return c.fromFetch?(c.response=a,Promise.resolve(c)):a[c.methodBody]().then((a)=>(c.result=a,a instanceof Blob&&!a.type&&(c.result=a.slice(a,a.size,c.mime)),c))}function h(b){return l.match(new Request(b.srcToRequest)).then(function(a){return a?g(b,a):y(b)})}function i(c,a){return c.date=new Date,l.put(a.url,a.clone()),g(c,a)}let j,k,l,m,n,o=[];const p={BLOB:'application/octet-stream',CSS:'text/css; charset="utf-8"',IMG:'image/jpeg',JS:'text/javascript; charset="utf-8"',JSON:'application/json; charset="utf-8"',TEXT:'text/plain; charset="utf-8"',FORMQ:'application/x-www-form-urlencoded',FORMDATA:'multipart/form-data'},q={NAME:'jrTable',VERSION:1,TABLE:'files',KEYPATH:'name'},r='0.0.1',s='H_JR',t='/assets/config/filesToUpdate.json';this.factoryError=function(b){j=b},this.getFile=function(d){let f={};return f.name=d.src.split('/'),f.name=f.name[f.name.length-1],Object.assign(f,{cache:!0,method:'GET',methodBody:'blob'},d),a(f),f.date=Date.parse(o[f.name]),f.srcToRequest=`${location.origin}/${d.src}`,f.getSavedFile=f.getSavedFile||h,f.saveFile=f.saveFile||i,x().then(()=>e(f).then((d)=>(d&&f.cache?f.getSavedFile(f):y(f)).then(b,c),c))},this.sendRequest=y,this.saveResponseDB=f,this.getResult=g,this.constants={HEADER_JR:s,CACHE_VERSION:r,FILESTOUPDATE:t}}.call(self.tools);