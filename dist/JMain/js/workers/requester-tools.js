self.tools={},function(){function a(){return o?Promise.resolve():caches.open(u).then((a)=>o=a)}function b(a){if(w==a.src&&p)return j(a,new Request(a.srcToRequest,{method:'POST',body:'[]'}));let b=new Request(a.srcToRequest,{method:a.method,cache:'no-cache',headers:new Headers({"Content-Type":a.mime,HEADER_JR:v}),body:JSON.stringify(a.value)});return fetch(b).then(function(b){if(!b.ok)throw`${b.status} ${b.statusText}`;let c;return c=a.cache?a.saveFile(a,b).then(i):j(a,b),c},(a)=>{throw a.message})}function c(a){return a.response instanceof Response?a.response:{result:a.result,path:a.src,observedId:a.observedId,ext:a.ext}}function d(a){var b,c,d=a.name.indexOf('?'),e=a.name;switch(-1<d&&(e=e.substring(0,d)),c=e.split('.'),c=c[c.length-1].toLowerCase(),c){case'jpg':case'png':b=s.BLOB,c='blob';break;case'css':b=s.CSS;break;case'js':b=s.JS;break;case'json':b=s.JSON,a.isText=!0,a.methodBody='json';break;case'txt':case'html':b=s.TEXT,a.methodBody='text',a.isText=!0;break;default:b=s.JS,c='js';}a.ext=c,a.mime=a.mime||b}function e(a){var b='Error: ';return b+=a,b+=', ',m?m(a.toString()):void 0,a}function f(a){return new Promise((b,c)=>{null===a.onerror&&(a.onerror=(b)=>c(b,a)),null===a.onsuccess?a.onsuccess=(c)=>b(c,a):b(a)})}function g(){let a,b;return new Promise(async(c)=>q?c(q):void(p=!1,r=navigator.onLine?await fetch(new Request(w,{cache:'no-cache'})).then((a)=>a.json()):{},a=indexedDB.open(t.NAME,t.VERSION),a.onupgradeneeded=async(a)=>{p=!0,q=a.target.result,b=q.createObjectStore(t.TABLE,{keyPath:t.KEYPATH}),b.createIndex(t.TABLE,t.KEYPATH),b.transaction.oncomplete=()=>c(q)},f(a).then((a)=>c(q=a.target.result))))}function h(a){async function b(b){let c=n[b.name],d=c&&!isNaN(b.date)?c.valueOf()>=b.date:!0;return!d&&(await o.match(a.src))&&(d=!0),d}return new Promise((c)=>n?c(b(a)):void g().then((d)=>{if(w==a.src&&p)return c(!1);let e=d.transaction(t.TABLE,'readonly').objectStore(t.TABLE).getAll();return f(e).then(()=>{n={},e.result.forEach((a)=>n[a[t.KEYPATH]]=a.date),c(b(a))})}))}function i(a){return g().then((b)=>{let c=b.transaction(t.TABLE,'readwrite').objectStore(t.TABLE).put({name:a.name,date:a.date});return f(c).then(()=>(n[a[t.KEYPATH]]=a.date,a))})}function j(a,b){return a.fromFetch?(a.response=b,Promise.resolve(a)):b[a.methodBody]().then((b)=>(a.result=b,b instanceof Blob&&!b.type&&(a.result=b.slice(b,b.size,a.mime)),a))}function k(a){return o.match(new Request(a.srcToRequest)).then(function(c){return c?j(a,c):b(a)})}function l(a,b){return a.date=new Date,o.put(b.url,b.clone()),j(a,b)}let m,n,o,p,q,r=[];const s={BLOB:'application/octet-stream',CSS:'text/css; charset="utf-8"',IMG:'image/jpeg',JS:'text/javascript; charset="utf-8"',JSON:'application/json; charset="utf-8"',TEXT:'text/plain; charset="utf-8"',FORMQ:'application/x-www-form-urlencoded',FORMDATA:'multipart/form-data'},t={NAME:'jrTable',VERSION:1,TABLE:'files',KEYPATH:'name'},u='0.0.1',v='H_JR',w='/assets/config/filesToUpdate.json';this.factoryError=function(a){m=a},this.getFile=function(f){let g={};return g.name=f.src.split('/'),g.name=g.name[g.name.length-1],Object.assign(g,{cache:!0,method:'GET',methodBody:'blob'},f),d(g),g.date=Date.parse(r[g.name]),g.srcToRequest=`${location.origin}/${f.src}`,g.getSavedFile=g.getSavedFile||k,g.saveFile=g.saveFile||l,a().then(()=>h(g).then((a)=>(a&&g.cache?g.getSavedFile(g):b(g)).then(c,e),e))},this.sendRequest=b,this.saveResponseDB=i,this.getResult=j,this.constants={HEADER_JR:v,CACHE_VERSION:u,FILESTOUPDATE:w}}.call(self.tools);