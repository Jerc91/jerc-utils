self.tools={},function(){function a(a){var b=new Request(a.srcToRequest,{method:a.method,cache:'no-cache',headers:new Headers({"Content-Type":a.mime}),body:JSON.stringify(a.value)});return fetch(b).then(function(b){if(!b.ok)throw`${b.status} ${b.statusText}`;let c;return c=a.cache?a.saveFile(a,b).then(h):i(a,b),c})}function b(a){return{result:a.result,path:a.src,observedId:a.observedId,ext:a.ext}}function c(a){var b,c,d=a.name.indexOf('?'),e=a.name;switch(-1<d&&(e=e.substring(0,d)),c=e.split('.'),c=c[c.length-1].toLowerCase(),c){case'jpg':case'png':b=l.BLOB,c='blob';break;case'css':b=l.CSS;break;case'js':b=l.JS;break;case'json':b=l.JSON,a.isText=!0,a.methodBody='json';break;case'txt':case'html':b=l.TEXT,a.methodBody='text',a.isText=!0;break;default:b=l.JS,c='js';}a.ext=c,a.mime=a.mime||b}function d(a){var b='Error: ';return b+=a,b+=', ',j?j(a.toString()):void 0,a}function e(a){return new Promise((b,c)=>{null===a.onerror&&(a.onerror=(b)=>c(b,a)),null===a.onsuccess?a.onsuccess=(c)=>b(c,a):b(a)})}function f(){var a,b,c;return new Promise((d)=>{a=indexedDB.open(m.NAME,m.VERSION),a.onupgradeneeded=(a)=>{c=a.target.result,b=c.createObjectStore(m.TABLE,{keyPath:m.KEYPATH}),b.createIndex(m.TABLE,m.KEYPATH),b.transaction.oncomplete=()=>d(c)},e(a).then((a)=>d(a.target.result))})}function g(a){function b(a){let b=k[a.name];return b&&!isNaN(a.date)?b.valueOf()>=a.date:!0}return new Promise((c)=>k?c(b(a)):void f().then((d)=>{let f=d.transaction(m.TABLE,'readonly').objectStore(m.TABLE).getAll();return e(f).then(()=>{k={},f.result.forEach((a)=>k[a[m.KEYPATH]]=a.date),c(b(a))})}))}function h(a){return f().then((b)=>{let c=b.transaction(m.TABLE,'readwrite').objectStore(m.TABLE).put({name:a.name,date:a.date});return e(c).then(()=>(k[a[m.KEYPATH]]=a.date,a))})}function i(a,b){return b[a.methodBody]().then((b)=>(a.result=b,b instanceof Blob&&!b.type&&(a.result=b.slice(b,b.size,a.mime)),a))}var j,k,l={BLOB:'application/octet-stream',CSS:'text/css; charset="utf-8"',IMG:'image/jpeg',JS:'text/javascript; charset="utf-8"',JSON:'application/json; charset="utf-8"',TEXT:'text/plain; charset="utf-8"',FORMQ:'application/x-www-form-urlencoded',FORMDATA:'multipart/form-data'},m={NAME:'jrTable',VERSION:1,TABLE:'files',KEYPATH:'name'};this.factoryError=function(a){j=a},this.getFile=function(e){var f={};return f.name=e.src.split('/'),f.name=f.name[f.name.length-1],Object.assign(f,{cache:!0,method:'GET',methodBody:'blob'},e),c(f),f.date=Date.parse(f.files[f.name]),f.srcToRequest=`${location.origin}/${e.src}`,g(f).then((c)=>(c&&f.cache?f.getSavedFile(f):a(f)).then(b,d),d)},this.sendRequest=a,this.saveResponseDB=h,this.getResult=i}.call(self.tools);