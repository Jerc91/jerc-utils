self.requestFileSystemSync=self.webkitRequestFileSystemSync||self.requestFileSystemSync,self.importScripts('requester-tools.js'),self.requester={},function(){var a={SIZEFILES:10485760,READ:{create:0},WRITE:{create:1}},b=null;self.requestFileSystemSync&&(b=b||self.requestFileSystemSync(TEMPORARY,a.SIZEFILES)),self.tools.factoryError(function(){}),this.getFile=function(c){try{if(!c.cache||!b)return self.tools.send(c);c.update=!0;var d=b.root.getFile(c.name,a.READ);return c.blob=d.file(),!isNaN(c.jdate)&&c.jdate>Date.parse(c.blob.lastModifiedDate)?self.tools.send(c):(c.update=!1,self.tools.getObject(c))}catch(a){if(-1<a.toString().indexOf('NotFoundError'))return self.tools.send(c);self.tools.error(a,c.name)}},this.save=function(c,d){var e=d.clone();return e.blob().then(function(d){var e,f=b.root.getFile(c.name,a.WRITE);return f.remove(),f=b.root.getFile(c.name,a.WRITE),e=f.createWriter(),e.write(d),d}).catch(self.tools.error)},this.removeAll=function(){var a=b.root.createReader(),c=a.readEntries();for(var d in c)c[d].remove()}}.apply(self.requester),self.addEventListener('message',function(a){var b=a.data;b.getFile=self.requester.getFile,b.save=self.requester.save;try{self.tools.get(a.data).then(self.postMessage).catch(self.tools.error)}catch(a){self.tools.error(a)}});